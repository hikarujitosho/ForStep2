# Bronze層からGold層KPIへの算出ロジック

## 収益性指標

### 月次商品別粗利率
**算出式:** (売上 - 売上原価) / 売上 × 100

**必要データ:**
- **売上**
  - 受注伝票_header, 受注伝票_item（受注した完成車と数量）
  - 条件マスタ（定価や取引先別販売価格）
- **売上原価**
  - 調達伝票_header, 調達伝票_item（完成車ごとの部品など直接材の調達額）

---

### 月次EBITDA
**算出式:** 売上 - 売上原価 - 販売管理費

**必要データ:**
- **売上**
  - 受注伝票_header, 受注伝票_item（受注した完成車と数量）
  - 条件マスタ（定価や取引先別販売価格）
- **売上原価**
  - 調達伝票_header, 調達伝票_item（完成車ごとの部品など直接材の調達額）
- **販売管理費**
  - 調達伝票_header, 調達伝票_item（工場運営等にかかる間接材の調達額）
  - 給与テーブル（人件費）

---

### 完成品別月次EBITDA
**算出式:** 完成品別売上 - 完成品別売上原価 - 完成品別販売管理費

**必要データ:**
- **完成品別売上**
  - 受注伝票_header, 受注伝票_item（完成車別の受注数量）
  - 条件マスタ（完成車別の販売価格）
- **完成品別売上原価**
  - 調達伝票_header, 調達伝票_item（完成車ごとの直接材調達額、product_idで紐付け）
- **完成品別販売管理費**
  - 調達伝票_header, 調達伝票_item（間接材を完成車別に配賦）
  - 給与テーブル（人件費を完成車別に配賦）

---

## 運転資本効率指標

### 棚卸資産回転期間
**算出式:** 期末在庫金額 / 売上

**必要データ:**
- **売上原価**
  - 調達伝票_header, 調達伝票_item（直接材の当月売上）
- **期末在庫金額**
  - 月次在庫履歴（月末時点の在庫数量）
  - 現在在庫（最新の在庫状況）
  - 条件マスタ（完成車別の販売価格）


---

### 完成品別棚卸資産回転期間
**算出式:** 完成品別期末在庫金額 / 完成品別売上

**必要データ:**
- **完成品別売上原価**
  - 調達伝票_header, 調達伝票_item（完成車ごとの当月売上）
- **完成品別期末在庫金額**
  - 月次在庫履歴（完成車別の月末在庫数量）
  - 条件マスタ（完成車別の販売価格）


---

## サプライチェーン効率指標

### 完成品出荷リードタイム遵守率
**算出式:** (納期内出荷件数 / 総出荷件数) × 100

**必要データ:**
- 受注伝票_header, 受注伝票_item（約束納期: promised_delivery_date）
- 出荷伝票_header, 出荷伝票_item（実際出荷日: actual_ship_timestamp）

---

### 取引先別部品入荷リードタイム遵守率
**算出式:** (納期内入荷件数 / 総入荷件数) × 100

**必要データ:**
- 調達伝票_header, 調達伝票_item（計画入荷日: 発注日＋リードタイム、実際入荷日: received_date）
- 取引先マスタ（サプライヤー情報）

---

## 物流コスト指標

### 緊急輸送費率
**算出式:** (緊急輸送費 / 総輸送費) × 100

**必要データ:**
- 輸送コスト（cost_type で緊急輸送と通常輸送を区分）

---

## 製品戦略指標

### 月次EV販売率
**算出式:** (EV完成車販売台数 / 全完成車販売台数) × 100

**必要データ:**
- 受注伝票_header, 受注伝票_item（完成車別の受注数量）
- 品目マスタ（EV車判定: item_hierarchy や detail_category）

---

### 月次エリア別EV販売率
**算出式:** (エリア別EV完成車販売台数 / エリア別全完成車販売台数) × 100

**必要データ:**
- 受注伝票_header, 受注伝票_item（完成車別の受注数量）
- 品目マスタ（EV車判定: item_hierarchy や detail_category）
- 取引先マスタ（ディーラーのエリア情報: region, country）

---

### 月次エリア別先進安全装置適用率
**算出式:** (エリア別先進安全装置搭載車販売台数 / エリア別全完成車販売台数) × 100

**必要データ:**
- 受注伝票_header, 受注伝票_item（完成車別の受注数量）
- 品目マスタ（先進安全装置搭載判定: item_hierarchy や detail_category）
- 取引先マスタ（ディーラーのエリア情報: region, country）
