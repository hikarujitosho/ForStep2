# Step2 Day2: 研修ワーク演習問題

---
### これから取り組む皆さまへのヒント

はじめての方や普段プログラミングに馴染みのない方でも、安心して演習を進めていただけるよう、下記のポイントをご案内します。

- **Python追加モジュールのインストールについて**
   - 例: `pip install pandas openpyxl` など
   - 必要なモジュールはAIの提案に従ってインストールしてください
   - これらのモジュールは、後段で行うデータベース構築やデータ分析の工程で必要となります

- **パス指定のコツ（Windows）**
   - フォルダやファイルのパス指定が何度も出てきます
   - Windowsエクスプローラーで対象フォルダ/ファイルを右クリック → 「パスのコピー」を選択すると、簡単かつ正確にパスを取得できます
   - コピーしたパスはAIへの指示やプログラムの設定時にそのまま貼り付けて使えます

- **データ粒度やJOIN時の注意点**
   - データを結合（JOIN）する際、テーブルごとに「データ粒度（1行が何を表すか）」が異なる場合があります。
   - 特に本演習では、完成品の販売価格を条件マスタから取得する際、期間指定で価格を判定するため単純なJOINができません。日付範囲での紐付けが上手くいっているか注意してください。
   - AIがこの粒度問題をどのように解決しているか、プロンプト例を参考にAIへ質問してみるのもおすすめです。


---


## 概要

本演習では、Day1で学んだデータマネジメントの知識を基に、実務に即したデータ基盤の設計・構築を擬似体験します。

**グループ分け:**

それぞれが取り組むKPIや業務性質が異なるため、以下の２グループに分かれ、それぞれワークをすすめてください。

- 物流系部署グループ：
- 間接材購買系部署グループ：

**使用ツール:** 生成AI（GitHub Copilot、MS365 Copilot 等）を積極的に活用

**重要:** 本研修は非エンジニア向けです。コーディングやシステム設計は、**生成AIを活用して進めてください**。技術的な知識がなくても、適切なプロンプトを書くことで、生成AIが具体的なコードや設計を提案してくれます。なお、迷った場合は各ワークに記載されている「プロンプト例」を参考に進めてください。
実際にプロンプト例を使ってAIと対話すれば、演習の最後まで問題なく進められることが実証されています。

---

## 午前セッション

### ワーク①: KPI設定

#### 目的
ROIC（投下資本利益率）に関連するKPIを設定した上で、必要なデータ基盤について考える。

#### 演習内容

**Step 1: 「モニタリング・分析」対象のKPIを洗い出し、算出方法を設計する**

今回の演習用ダミーデータをよく確認した上で、ROICの構成要素（NOPAT、投下資本）を意識しながら、グループでモニタリングおよび分析できるKPIを3~5個洗い出してください。
また、洗い出したKPIごとに、KPIの算出方法（計算式）、KPIモニタリングのデータ項目設計、KPI改善分析に必要な分析軸なども定義してください。
なお、フォルダ内のダミーデータがKPIの算出に必要な要素を完全に網羅していない場合、必要な項目はAI対話の中で必要な前提や数値を仮置きして分析を進めて構いません。

**物流系の例:**
- 配送遅延率（OTD: On-Time Delivery）
- 在庫回転率
- 輸送コスト率（売上高対比）
- 緊急配送発生率

**間接材購買系（MRO）の例:**
- 間接材調達コスト削減率
- 緊急発注率（スポット購買率） 
- MRO在庫日数
- サプライヤー納期遵守率（OTD）

**生成AIの活用方法:**
```prompt
＝＝＝プロンプト例＝＝＝

「自動車製造業の[物流部門/間接材購買部門]において、下記に指定するフォルダ内のデータおよび定義書を確認した上で、ROIC（投下資本利益率）の改善に直結するKPIを5つ提案してください。

演習用のデータや定義書：　[演習用のデータや定義書のフォルダパスを指定]

各KPIについて以下を含めてください：
- KPI名
- 算出方法
- 必要なデータソース
- ROICへの貢献（NOPAT向上 or 投下資本削減）
- KPIモニタリングの代表的な項目
- KPI改善分析に利用できる分析軸

【重要】ファイルやスクリプトを新規作成する際は、必ず「README_folder_structure.md」に記載されたフォルダ運用ルールに従ってください。
AIは、用途に応じて必要なフォルダ（scripts, output, database等）を新規作成し、必ず正しい場所に整理・保存するようにしてください。

```

**提出物:** KPI一覧表（KPI名、計算式、目標値、データソース）


---

### ワーク②: データ基盤設計

#### 目的
ワーク①で設定したKPIを実現するために必要なデータ基盤を設計します。
グループで2~3つのKPIを選び、KPIごとに担当者（もしくは担当ペア）を決めてください。

#### 演習内容

**Step 2-1: 必要なデータソースを特定する**

KPIを算出するために必要なデータソースを洗い出してください。

**データソースの例:**
- ERP（財務、原価センタ）
- MES（製造実行システム：設備稼働、故障履歴）
- WMS（倉庫管理システム：在庫レベル、入出庫）
- TMS（輸配送管理システム：配送実績、リードタイム）
- P2P（購買管理システム：発注、請求履歴）
- others （社内システム：設備管理、カレンダー定義）

**生成AIの活用方法:**
```
＝＝＝プロンプト例＝＝＝
「以下のKPIを算出するために必要なデータソースを特定してください：
ワーク①で設定したKPI一覧：　[ワーク①で設定したKPI一覧をコピー&ペースト]
演習用のデータや定義書：　[演習用のデータや定義書のフォルダパスを再度指定]

各データソースについて以下を含めてください：
- 必要なデータの内容（例：発注履歴、在庫レベル）
- データの更新頻度（リアルタイム、日次、月次等）
- データの重要度（高/中/低）
表形式で出力してください。」
```


**提出物:** データソース一覧表（システム名、データ内容、更新頻度）

---

**Step 2-2: データマートのテーブル設計**

KPIを算出し、そのKPI用のモニタリング用テーブル（例えば、日報用エクセルシートみたいなもの。研修ではGoldデータとして紹介。データマートなどとも呼ばれる）を設計してください。

**設計すべきテーブルの例:**
1. **ファクトテーブル（トランザクションデータ）**
   - 物流系: 配送実績ファクト、在庫移動ファクト
   - 購買系: 請求ファクト、発注ファクト
   
2. **ディメンションテーブル（マスターデータ）**
   - 共通: 日付、拠点/倉庫、サプライヤー
   - 物流系: 輸送手段、ルート、顧客
   - 購買系: 品目、原価センタ、設備

**各テーブルに対して以下を定義してください:**
- テーブル名
- 主要なカラム（5~10個程度）
- 各カラムのデータ型
- 主キー（PK）と外部キー（FK）の関係

**ヒント:**
- データ粒度を明確に：1レコード（行）が何を表すか

**生成AIの活用方法:**

```
＝＝＝プロンプト例＝＝＝
自動車製造業の[物流/間接材購買]のデータ基盤のメダリオンアーキテクチャにおけるSilver/Goldのデータテーブルの設計書を作成してください。
Gold用のテーブルは、5つのKPIのうち、以下の私が担当する一つのKPIをモニタリングするために活用します。
モニタリングするKPI：　[自分が担当するKPIとその定義をコピー&ペーストまたは参照]
Silver用のテーブルは、Gold用テーブルの元データとしても利用され、KPI算出の前処理やKPIの改善分析にも使われます。
なお、Bronze（生データ）は、次に指定するデータソースおよびそこから抽出されたテーブル群を指します。

演習用のデータや定義書：　[演習用のデータや定義書のフォルダパスを再度指定]

以下を含めてください：
- Gold / Silver のテーブル定義書のマークダウン書式での保存（保存先が分からなければ聞いてください）
- 各テーブルを作成する方法（SQL等）

それではステップバイステップで行きましょう。何か分からないことがあれば私に必ず聞いてください。
```

### ワーク③: データ基盤構築

#### 目的
設計したデータ基盤を実際に構築し、Bronze/Silver/Goldデータベースを作成し、分析テストを行う。

#### 演習内容

これまで設計したKPIのモニタリング/分析環境を実際に構築していきます。

 - 1. 必要なデータを演習用ダミーデータから選出。この時、初期構築(`initial_build/`)用csvファイルを利用してください。このcsvデータが今回のBronzeデータ（生データ）となります。
 - 2. 生成AIを活用して、BronzeからSilverに変換するプログラムを生成させ、Silverをデータベースに格納します。今回は、SQLite（軽量データベースエンジン）を使用します。
 - 3. 生成AIを活用して、SilverからGoldに変換するプログラムを生成させ、Goldテーブルをデータベースに格納します。
 - 4. 作成したGoldテーブルを用いて、生成AIにKPIのモニタリングを指示し、結果を確認します。

**生成AIの活用方法:**
```
＝＝＝プロンプト例＝＝＝
非エンジニアの私が、ローカル環境で自動車製造業の間接材調達コスト削減率をモニタリングするためのデータ分析基盤を構築したいです。
以下の設計書とデータを使って、SQLiteデータベースを作成し、KPI計算まで実行できる環境を整えてください。

# データ分析基盤の技術的な要件
- 元データ（Bronzeデータ）は、csvファイルです。
- Silver, GoldデータはSQLiteデータベースに格納します。
- SilverはKPI算出の前処理やKPI改善分析に利用されます。
- GoldはKPIモニタリングに利用されます。

# Python環境の要件
- バージョン: Python 3.8以上
- 必要ライブラリ: pandas, sqlite3（標準ライブラリ）, openpyxl
- 仮想環境の使用を推奨

# 業務要件
前のワークで設定したKPIとその定義：　[前のワークで設定したKPIとその定義をコピー&ペーストまたはファイルパスを参照]
演習用の必要なcsvデータとテーブル定義：　[演習用の必要なcsvデータとテーブル定義のフォルダパスを参照]
Silver/Goldテーブル定義：　[Silver/Goldテーブル定義のファイルパスを参照]
```


### ワーク④: データ活用（60分）

#### 目的
構築したデータ基盤を用いて、設定したKPIのモニタリングや分析を実行する。

#### 演習内容
前のワークで構築したデータベース（データ基盤）を利用し、KPIのモニタリングおよび分析を段階的に実施してください。
作業は以下の2フェーズに分けて行います。

 **【フェーズ1：現状把握（モニタリング・可視化）】
 - 1. 組織として定期的に確認すべきKPIのモニタリングレポートを、複数パターン作成してください。
 - 2. データベースに基づき、KPIの現状を事実ベースで可視化し、構造的に分析してください。※このフェーズでは改善提案は行わず、“現状の理解・見える化” に専念してください。**
 
 **【フェーズ2：改善フェーズ（深掘り分析・施策提案）】
 - 3. 担当するKPIについて深掘り分析を行い、改善の方向性や具体的な提案をまとめてください。
 - 4. フェーズ1・2の成果をグループ内で共有し、ディスカッションしてください。**

**生成AIの活用方法:**

```
＝＝＝KPIモニタリングレポートのプロンプト例＝＝＝
構築済みのデータベースファイルを分析し、KPIモニタリングレポートを作成してください。
KPIの現状を正しく把握することを目的として、以下の視点でKPIをドリルダウンし、事実ベースで可視化したモニタリング帳票を作成してください。
※本段階では改善施策やアクションプランの提案は不要です。現状把握に専念してください

# 視点例：
 - KPIの時系列推移
 - セグメント（拠点、サプライヤー等）別比較

# 出力形式：

以下の**3つの形式**でレポートを作成してください：

1. **Markdownレポート**（詳細分析用）
    - ファイル名: `KPI_monitoring_report_YYYYMMDD.md`
    - 内容: 全分析視点を含む完全版レポート
    - 対象: データアナリスト、部門管理者

2. **HTMLレポート**（プレゼン用）
    - ファイル名: `KPI_monitoring_report_YYYYMMDD.html`
    - 内容: グラフィカルな表示、カラフルな評価表示
    - 対象: 経営層向けプレゼンテーション

3. **CSVエクスポート**（Excel/Power BI用）
    - 以下のCSVファイルを生成:
       - `kpi_trend.csv`: 時系列データ
       - `location_comparison.csv`: 拠点別比較
       - `supplier_ranking.csv`: サプライヤーランキング
       - `action_items.csv`: 改善アクション項目
    - 対象: Excelでのピボット分析、Power BIダッシュボード



前のワークで設定したKPIとその定義：　[前のワークで設定したKPIとその定義をコピー&ペーストまたはファイルパスを参照]
前のワークで設定したGoldテーブル定義：　[前のワークで作成したGoldテーブル定義をコピー&ペーストまたはファイルパスを参照]
```

```
＝＝＝KPI改善分析レポートのプロンプト例＝＝＝
<構築したデータベースファイルを指定> を分析して、KPIの改善分析レポートを作成したいです。私と対話的に分析をすすめ、KPI改善に向けた具体的な施策提案をまとめてください。

前のワークで設定したKPIとその定義：　[前のワークで設定したKPIとその定義をコピー&ペーストまたはファイルパスを参照]
前のワークで作成したGold/Silverテーブル定義：　[前のワークで作成したGold/Silverテーブル定義のファイルパスを参照]
前のワークで作成したKPIモニタリングレポート：　[前のワークで作成したKPIモニタリングレポートの内、Markdownレポートのファイルパスを参照]
```

## よくある質問（FAQ）

**Q1: 生成AIはどこまで使ってよいですか？**
A: 積極的に活用してください。本研修の目的は「生成AIを活用してデータ基盤を構築できるスキル」を身につけることです。ただし、生成されたコードやクエリの実行結果に**必ず自分が責任を負う**ことを意識してください。コードを理解することが難しくても、コードをAIに解説させることは可能です。なんらかの方法で、実行内容を理解した上で使用してください。

**Q2: 生成AIの回答が間違っている場合はどうすればよいですか？**
A: 生成AIは完璧ではありません。以下の対処法を試してください：
- エラーメッセージを生成AIに貼り付けて、修正を依頼する
- AIに「もっと詳しく説明して」「レビューして」「作成したプログラムの動作検証テストをして」となどの追加指示を出す
- 講師に質問する

**Q3: 実務で使っているツール（例: AWS、Snowflake）を使ってもよいですか？**
A: 可能であれば問題ありません。ただし、本演習の範囲では、ローカル環境（SQLite等）で十分です。実務環境を使う場合は、**本番データを誤って触らないよう**十分注意してください。

**Q4: 生成AIへのプロンプトの書き方がわかりません。**
A: 各ワークに「プロンプト例」を記載していますので、それをコピー&ペーストして使ってください。慣れてきたら、自分の言葉でアレンジしてみましょう。

---

**Good Luck! 楽しみながら学びましょう！**
